<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="nagios system status" author="k4m6a7"/> 
  <UserPref name="user" display_name="Nagios Username" required="true"/>
  <UserPref name="pass" display_name="Nagios Password" required="true"/>
  <UserPref name="url" display_name="URL to Nagios statusjson.cgi" required="true"/>
  <UserPref name="host" display_name="Host Name" required="true"/>
  <UserPref name="service" display_name="Service Description" required="true"/>
  <Content type="html">
     <![CDATA[ 
     <script type="text/javascript">
         var user = prefs.getString("user");
         var pass = prefs.getString("pass"); 
         var url = prefs.getString("url");
         var host = prefs.getString("host");
         var service = prefs.getString("service");

         var params = {};
         params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;  

         var request_uri = 'http://' + user + ':' + pass + '@' + url + '?query=service&hostname=' + host + '&servicedescription=' + service;

         var handleStatus = function(response) {
             document.getElementById('body').innerHTML = response.text;
         }

         var getStatus = function() {
            gadgets.io.makeRequest(request_uri, handleStatus, params);
         }

         var onGadgetLoad = function() {
             setTimeout(getStatus, 15000);
         }

         gadgets.util.registerOnLoadHandler(onGadgetLoad);
     </script>
     <div id="body"></div>
     ]]>
  </Content> 
</Module>
